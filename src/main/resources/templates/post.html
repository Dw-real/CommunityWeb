<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
  <meta charset="UTF-8">
  <meta name="_csrf_header" th:content="${_csrf.headerName}">
  <meta name="_csrf" th:content="${_csrf.token}">
  <title>게시글 작성</title>
  <link rel="stylesheet" href="/css/style.css">
  <link rel="stylesheet" href="/css/posting.css">
  <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
</head>
<body>
<h1>게시글 작성</h1>
<form id="postForm" enctype="multipart/form-data">
  <label for="boardFile" class="custom-file-label"></label>
  <input type="file" id="boardFile" class="custom-file-input" multiple hidden><br>
  <input type="text" id="boardTitle"> <br>
  <textarea id="boardContents" cols="50" rows="10"></textarea> <br>
  <input type = "submit" value="작성 완료">
</form>

<script>
  $(document).ready(function() {
    $('#postForm').submit(function(event) {
      event.preventDefault();

      var boardTitle = $('#boardTitle').val();
      var boardContents = $('#boardContents').val();
      var userCode = [[${user.userCode}]];

      var header = $("meta[name='_csrf_header']").attr('content');
      var token = $("meta[name='_csrf']").attr('content');

      // 파일 첨부 여부 확인
      var formData = new FormData();
      var boardFile = $('#boardFile')[0].files;

      // formData에 파일 추가
      if (boardFile.length > 0) {
        for (var i = 0; i < boardFile.length; i++) {
            formData.append("boardFile", boardFile[i]);
        }
      }

      formData.append("boardTitle", boardTitle);
      formData.append("boardContents", boardContents);
      formData.append("userCode", userCode);

      $.ajax({
          type: 'POST',
          url: '/community/post',
          data: formData,
          contentType: false,
          processData: false,
          beforeSend: function(xhr) {
            xhr.setRequestHeader(header, token);
          },
          success: function(response) {
              window.location.href = '/';
          },
          error: function(xhr, status, error) {
              // 오류가 발생하면 메시지 표시
          }
      });
    });
  });
</script>
</body>
</html>